@model MemberViewModel
@{
    ViewData["Title"] = Model.FullName;
    var loans = ViewBag.Loans as List<Loan>;
}

<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Index", "Members")">Üyeler</a></li>
        <li class="breadcrumb-item active">@Model.FullName</li>
    </ol>
</nav>

<div class="row g-4">
    <!-- Üye Bilgileri -->
    <div class="col-lg-4">
        <div class="table-container">
            <div class="text-center mb-4">
                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                    <i class="bi bi-person-fill fs-1"></i>
                </div>
            </div>
            <h4 class="fw-bold text-center mb-2">@Model.FullName</h4>
            <p class="text-muted text-center mb-4">@Model.Email</p>

            <table class="table table-sm">
                <tr>
                    <th class="text-muted">Telefon</th>
                    <td>@(Model.Phone ?? "-")</td>
                </tr>
                <tr>
                    <th class="text-muted">Üyelik Tarihi</th>
                    <td>@Model.JoinedAt.ToString("dd.MM.yyyy")</td>
                </tr>
                <tr>
                    <th class="text-muted">Rol</th>
                    <td>
                        @{
                            var roleText = Model.Role switch
                            {
                                "admin" => "Yönetici",
                                "librarian" => "Kütüphaneci",
                                _ => "Üye"
                            };
                        }
                        @roleText
                    </td>
                </tr>
                <tr>
                    <th class="text-muted">Durum</th>
                    <td>
                        @{
                            var statusText = Model.Status switch
                            {
                                "active" => "Aktif",
                                "inactive" => "Pasif",
                                "suspended" => "Askıda",
                                _ => Model.Status
                            };
                        }
                        @statusText
                    </td>
                </tr>
                <tr>
                    <th class="text-muted">Ödünç Limiti</th>
                    <td>@Model.ActiveLoans / @Model.MaxLoanLimit</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Ödünç Geçmişi -->
    <div class="col-lg-8">
        <div class="table-container">
            <h5 class="mb-4 fw-semibold">
                <i class="bi bi-clock-history me-2"></i>Ödünç Geçmişi (@Model.TotalLoans)
            </h5>

            @if (loans?.Any() == true)
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>Kitap</th>
                                <th>Ödünç Tarihi</th>
                                <th>Teslim Tarihi</th>
                                <th>İade Tarihi</th>
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var loan in loans)
                            {
                                <tr>
                                    <td class="fw-medium">@loan.Copy?.Book?.Title</td>
                                    <td>@loan.LoanedAt.ToString("dd.MM.yyyy")</td>
                                    <td>@loan.DueAt.ToString("dd.MM.yyyy")</td>
                                    <td>@(loan.ReturnedAt?.ToString("dd.MM.yyyy") ?? "-")</td>
                                    <td>
                                        @if (loan.ReturnedAt != null)
                                        {
                                            <span class="badge badge-active">İade Edildi</span>
                                        }
                                        else if (loan.IsOverdue)
                                        {
                                            <span class="badge badge-overdue">Gecikmiş</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-loaned">Aktif</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                    Henüz ödünç geçmişi yok
                </div>
            }
        </div>
    </div>
</div>
